// auto-generated by sqlc - do not edit
using System;
using System.Linq;
using System.Text.RegularExpressions;

namespace SqliteSqlcImpl;
public static class Utils
{
    private static readonly Regex ValuesRegex = new Regex(@"VALUES\s*\((?<params>[^)]*)\)", RegexOptions.IgnoreCase);
    public static string TransformQueryForSqliteBatch(string originalSql, int cntRecords)
    {
        var match = ValuesRegex.Match(originalSql);
        if (!match.Success)
            throw new ArgumentException("The query does not contain a valid VALUES clause.");
        var valuesParams = match.Groups["params"].Value.Split(',').Select(p => p.Trim()).ToList();
        var batchRows = Enumerable.Range(0, cntRecords).Select(i => "(" + string.Join(", ", valuesParams.Select(p => $"{p}{i}")) + ")");
        var batchValuesClause = "VALUES " + string.Join(",\n", batchRows);
        return ValuesRegex.Replace(originalSql, batchValuesClause);
    }
}