// auto-generated by sqlc - do not edit
// ReSharper disable UseObjectOrCollectionInitializer
// ReSharper disable UseAwaitUsing
// ReSharper disable ConvertToUsingDeclaration
// ReSharper disable NotAccessedPositionalProperty.Global
// ReSharper disable UnusedAutoPropertyAccessor.Global
using Microsoft.Data.Sqlite;
using System;
using System.Collections.Generic;
using System.Data;
using System.Threading;
using System.Threading.Tasks;

namespace SqliteSqlcImpl;
public class QuerySql
{
    public QuerySql()
    {
    }

    public QuerySql(string connectionString) : this()
    {
        this.ConnectionString = connectionString;
    }

    private QuerySql(SqliteTransaction transaction) : this()
    {
        this.Transaction = transaction;
    }

    public static QuerySql WithTransaction(SqliteTransaction transaction)
    {
        return new QuerySql(transaction);
    }

    private SqliteTransaction? Transaction { get; }
    private string? ConnectionString { get; }

    private const string GetCustomerOrdersSql = @"SELECT 
                                                      o.order_id, ordered_at, order_state, total_amount, order_item_id, i.quantity, i.unit_price, 
                                                      p.product_id, p.name as product_name, p.category as product_category
                                                  FROM orders o
                                                  JOIN order_items i
                                                  USING (order_id)
                                                  JOIN products p
                                                  USING (product_id)
                                                  WHERE o.customer_id = @customer_id
                                                  ORDER BY o.ordered_at DESC
                                                  LIMIT @limit OFFSET @offset";
    public readonly record struct GetCustomerOrdersRow(int OrderId, string OrderedAt, string OrderState, decimal TotalAmount, int OrderItemId, int Quantity, decimal UnitPrice, int ProductId, string ProductName, string ProductCategory);
    public readonly record struct GetCustomerOrdersArgs(int CustomerId, int Offset, int Limit);
    public async Task<List<GetCustomerOrdersRow>> GetCustomerOrdersAsync(GetCustomerOrdersArgs args)
    {
        if (this.Transaction == null)
        {
            using (var connection = new SqliteConnection(ConnectionString))
            {
                await connection.OpenAsync();
                using (var command = new SqliteCommand(GetCustomerOrdersSql, connection))
                {
                    command.Parameters.AddWithValue("@customer_id", args.CustomerId);
                    command.Parameters.AddWithValue("@offset", args.Offset);
                    command.Parameters.AddWithValue("@limit", args.Limit);
                    using (var reader = await command.ExecuteReaderAsync())
                    {
                        var result = new List<GetCustomerOrdersRow>();
                        while (await reader.ReadAsync())
                            result.Add(new GetCustomerOrdersRow { OrderId = reader.GetInt32(0), OrderedAt = reader.GetString(1), OrderState = reader.GetString(2), TotalAmount = reader.GetDecimal(3), OrderItemId = reader.GetInt32(4), Quantity = reader.GetInt32(5), UnitPrice = reader.GetDecimal(6), ProductId = reader.GetInt32(7), ProductName = reader.GetString(8), ProductCategory = reader.GetString(9) });
                        return result;
                    }
                }
            }
        }

        if (this.Transaction?.Connection == null || this.Transaction?.Connection.State != ConnectionState.Open)
            throw new InvalidOperationException("Transaction is provided, but its connection is null.");
        using (var command = this.Transaction.Connection.CreateCommand())
        {
            command.CommandText = GetCustomerOrdersSql;
            command.Transaction = this.Transaction;
            command.Parameters.AddWithValue("@customer_id", args.CustomerId);
            command.Parameters.AddWithValue("@offset", args.Offset);
            command.Parameters.AddWithValue("@limit", args.Limit);
            using (var reader = await command.ExecuteReaderAsync())
            {
                var result = new List<GetCustomerOrdersRow>();
                while (await reader.ReadAsync())
                    result.Add(new GetCustomerOrdersRow { OrderId = reader.GetInt32(0), OrderedAt = reader.GetString(1), OrderState = reader.GetString(2), TotalAmount = reader.GetDecimal(3), OrderItemId = reader.GetInt32(4), Quantity = reader.GetInt32(5), UnitPrice = reader.GetDecimal(6), ProductId = reader.GetInt32(7), ProductName = reader.GetString(8), ProductCategory = reader.GetString(9) });
                return result;
            }
        }
    }

    private const string AddCustomersSql = "INSERT INTO customers (name, email, phone, address, registered_at) VALUES (@name, @email, @phone, @address, @registered_at)";
    public readonly record struct AddCustomersArgs(string Name, string Email, string Phone, string? Address, string RegisteredAt);
    public async Task AddCustomersAsync(List<AddCustomersArgs> args)
    {
        using (var connection = new SqliteConnection(ConnectionString))
        {
            var transformedSql = Utils.TransformQueryForSqliteBatch(AddCustomersSql, args.Count);
            await connection.OpenAsync();
            using (var command = new SqliteCommand(transformedSql, connection))
            {
                for (int i = 0; i < args.Count; i++)
                {
                    command.Parameters.AddWithValue($"@name{i}", args[i].Name);
                    command.Parameters.AddWithValue($"@email{i}", args[i].Email);
                    command.Parameters.AddWithValue($"@phone{i}", args[i].Phone);
                    command.Parameters.AddWithValue($"@address{i}", args[i].Address ?? (object)DBNull.Value);
                    command.Parameters.AddWithValue($"@registered_at{i}", args[i].RegisteredAt);
                }

                await command.ExecuteScalarAsync();
            }
        }
    }

    private const string AddProductsSql = "INSERT INTO products (name, category, unit_price, stock_quantity, description) VALUES (@name, @category, @unit_price, @stock_quantity, @description)";
    public readonly record struct AddProductsArgs(string Name, string Category, decimal UnitPrice, int StockQuantity, string? Description);
    public async Task AddProductsAsync(List<AddProductsArgs> args)
    {
        using (var connection = new SqliteConnection(ConnectionString))
        {
            var transformedSql = Utils.TransformQueryForSqliteBatch(AddProductsSql, args.Count);
            await connection.OpenAsync();
            using (var command = new SqliteCommand(transformedSql, connection))
            {
                for (int i = 0; i < args.Count; i++)
                {
                    command.Parameters.AddWithValue($"@name{i}", args[i].Name);
                    command.Parameters.AddWithValue($"@category{i}", args[i].Category);
                    command.Parameters.AddWithValue($"@unit_price{i}", args[i].UnitPrice);
                    command.Parameters.AddWithValue($"@stock_quantity{i}", args[i].StockQuantity);
                    command.Parameters.AddWithValue($"@description{i}", args[i].Description ?? (object)DBNull.Value);
                }

                await command.ExecuteScalarAsync();
            }
        }
    }

    private const string AddOrdersSql = "INSERT INTO orders (customer_id, order_state, total_amount) VALUES (@customer_id, @order_state, @total_amount)";
    public readonly record struct AddOrdersArgs(int CustomerId, string OrderState, decimal TotalAmount);
    public async Task AddOrdersAsync(List<AddOrdersArgs> args)
    {
        using (var connection = new SqliteConnection(ConnectionString))
        {
            var transformedSql = Utils.TransformQueryForSqliteBatch(AddOrdersSql, args.Count);
            await connection.OpenAsync();
            using (var command = new SqliteCommand(transformedSql, connection))
            {
                for (int i = 0; i < args.Count; i++)
                {
                    command.Parameters.AddWithValue($"@customer_id{i}", args[i].CustomerId);
                    command.Parameters.AddWithValue($"@order_state{i}", args[i].OrderState);
                    command.Parameters.AddWithValue($"@total_amount{i}", args[i].TotalAmount);
                }

                await command.ExecuteScalarAsync();
            }
        }
    }

    private const string AddOrderItemsSql = "INSERT INTO order_items (order_id, product_id, quantity, unit_price) VALUES (@order_id, @product_id, @quantity, @unit_price)";
    public readonly record struct AddOrderItemsArgs(int OrderId, int ProductId, int Quantity, decimal UnitPrice);
    public async Task AddOrderItemsAsync(List<AddOrderItemsArgs> args)
    {
        using (var connection = new SqliteConnection(ConnectionString))
        {
            var transformedSql = Utils.TransformQueryForSqliteBatch(AddOrderItemsSql, args.Count);
            await connection.OpenAsync();
            using (var command = new SqliteCommand(transformedSql, connection))
            {
                for (int i = 0; i < args.Count; i++)
                {
                    command.Parameters.AddWithValue($"@order_id{i}", args[i].OrderId);
                    command.Parameters.AddWithValue($"@product_id{i}", args[i].ProductId);
                    command.Parameters.AddWithValue($"@quantity{i}", args[i].Quantity);
                    command.Parameters.AddWithValue($"@unit_price{i}", args[i].UnitPrice);
                }

                await command.ExecuteScalarAsync();
            }
        }
    }

    private const string GetCustomerIdsSql = "SELECT customer_id FROM customers ORDER BY customer_id LIMIT @limit";
    public readonly record struct GetCustomerIdsRow(int CustomerId);
    public readonly record struct GetCustomerIdsArgs(int Limit);
    public async Task<List<GetCustomerIdsRow>> GetCustomerIdsAsync(GetCustomerIdsArgs args)
    {
        if (this.Transaction == null)
        {
            using (var connection = new SqliteConnection(ConnectionString))
            {
                await connection.OpenAsync();
                using (var command = new SqliteCommand(GetCustomerIdsSql, connection))
                {
                    command.Parameters.AddWithValue("@limit", args.Limit);
                    using (var reader = await command.ExecuteReaderAsync())
                    {
                        var result = new List<GetCustomerIdsRow>();
                        while (await reader.ReadAsync())
                            result.Add(new GetCustomerIdsRow { CustomerId = reader.GetInt32(0) });
                        return result;
                    }
                }
            }
        }

        if (this.Transaction?.Connection == null || this.Transaction?.Connection.State != ConnectionState.Open)
            throw new InvalidOperationException("Transaction is provided, but its connection is null.");
        using (var command = this.Transaction.Connection.CreateCommand())
        {
            command.CommandText = GetCustomerIdsSql;
            command.Transaction = this.Transaction;
            command.Parameters.AddWithValue("@limit", args.Limit);
            using (var reader = await command.ExecuteReaderAsync())
            {
                var result = new List<GetCustomerIdsRow>();
                while (await reader.ReadAsync())
                    result.Add(new GetCustomerIdsRow { CustomerId = reader.GetInt32(0) });
                return result;
            }
        }
    }

    private const string GetProductIdsSql = "SELECT product_id FROM products ORDER BY product_id LIMIT @limit";
    public readonly record struct GetProductIdsRow(int ProductId);
    public readonly record struct GetProductIdsArgs(int Limit);
    public async Task<List<GetProductIdsRow>> GetProductIdsAsync(GetProductIdsArgs args)
    {
        if (this.Transaction == null)
        {
            using (var connection = new SqliteConnection(ConnectionString))
            {
                await connection.OpenAsync();
                using (var command = new SqliteCommand(GetProductIdsSql, connection))
                {
                    command.Parameters.AddWithValue("@limit", args.Limit);
                    using (var reader = await command.ExecuteReaderAsync())
                    {
                        var result = new List<GetProductIdsRow>();
                        while (await reader.ReadAsync())
                            result.Add(new GetProductIdsRow { ProductId = reader.GetInt32(0) });
                        return result;
                    }
                }
            }
        }

        if (this.Transaction?.Connection == null || this.Transaction?.Connection.State != ConnectionState.Open)
            throw new InvalidOperationException("Transaction is provided, but its connection is null.");
        using (var command = this.Transaction.Connection.CreateCommand())
        {
            command.CommandText = GetProductIdsSql;
            command.Transaction = this.Transaction;
            command.Parameters.AddWithValue("@limit", args.Limit);
            using (var reader = await command.ExecuteReaderAsync())
            {
                var result = new List<GetProductIdsRow>();
                while (await reader.ReadAsync())
                    result.Add(new GetProductIdsRow { ProductId = reader.GetInt32(0) });
                return result;
            }
        }
    }

    private const string GetOrderIdsSql = "SELECT order_id FROM orders ORDER BY order_id LIMIT @limit";
    public readonly record struct GetOrderIdsRow(int OrderId);
    public readonly record struct GetOrderIdsArgs(int Limit);
    public async Task<List<GetOrderIdsRow>> GetOrderIdsAsync(GetOrderIdsArgs args)
    {
        if (this.Transaction == null)
        {
            using (var connection = new SqliteConnection(ConnectionString))
            {
                await connection.OpenAsync();
                using (var command = new SqliteCommand(GetOrderIdsSql, connection))
                {
                    command.Parameters.AddWithValue("@limit", args.Limit);
                    using (var reader = await command.ExecuteReaderAsync())
                    {
                        var result = new List<GetOrderIdsRow>();
                        while (await reader.ReadAsync())
                            result.Add(new GetOrderIdsRow { OrderId = reader.GetInt32(0) });
                        return result;
                    }
                }
            }
        }

        if (this.Transaction?.Connection == null || this.Transaction?.Connection.State != ConnectionState.Open)
            throw new InvalidOperationException("Transaction is provided, but its connection is null.");
        using (var command = this.Transaction.Connection.CreateCommand())
        {
            command.CommandText = GetOrderIdsSql;
            command.Transaction = this.Transaction;
            command.Parameters.AddWithValue("@limit", args.Limit);
            using (var reader = await command.ExecuteReaderAsync())
            {
                var result = new List<GetOrderIdsRow>();
                while (await reader.ReadAsync())
                    result.Add(new GetOrderIdsRow { OrderId = reader.GetInt32(0) });
                return result;
            }
        }
    }

    private const string GetOrderAmountsSql = "SELECT order_id, total_amount FROM orders WHERE order_id IN (/*SLICE:order_ids*/@order_id)";
    public readonly record struct GetOrderAmountsRow(int OrderId, decimal TotalAmount);
    public readonly record struct GetOrderAmountsArgs(int OrderId);
    public async Task<List<GetOrderAmountsRow>> GetOrderAmountsAsync(GetOrderAmountsArgs args)
    {
        if (this.Transaction == null)
        {
            using (var connection = new SqliteConnection(ConnectionString))
            {
                await connection.OpenAsync();
                using (var command = new SqliteCommand(GetOrderAmountsSql, connection))
                {
                    command.Parameters.AddWithValue("@order_id", args.OrderId);
                    using (var reader = await command.ExecuteReaderAsync())
                    {
                        var result = new List<GetOrderAmountsRow>();
                        while (await reader.ReadAsync())
                            result.Add(new GetOrderAmountsRow { OrderId = reader.GetInt32(0), TotalAmount = reader.GetDecimal(1) });
                        return result;
                    }
                }
            }
        }

        if (this.Transaction?.Connection == null || this.Transaction?.Connection.State != ConnectionState.Open)
            throw new InvalidOperationException("Transaction is provided, but its connection is null.");
        using (var command = this.Transaction.Connection.CreateCommand())
        {
            command.CommandText = GetOrderAmountsSql;
            command.Transaction = this.Transaction;
            command.Parameters.AddWithValue("@order_id", args.OrderId);
            using (var reader = await command.ExecuteReaderAsync())
            {
                var result = new List<GetOrderAmountsRow>();
                while (await reader.ReadAsync())
                    result.Add(new GetOrderAmountsRow { OrderId = reader.GetInt32(0), TotalAmount = reader.GetDecimal(1) });
                return result;
            }
        }
    }

    private const string GetProductPricesSql = "SELECT product_id, unit_price FROM products WHERE product_id IN (/*SLICE:product_ids*/@product_id)";
    public readonly record struct GetProductPricesRow(int ProductId, decimal UnitPrice);
    public readonly record struct GetProductPricesArgs(int ProductId);
    public async Task<List<GetProductPricesRow>> GetProductPricesAsync(GetProductPricesArgs args)
    {
        if (this.Transaction == null)
        {
            using (var connection = new SqliteConnection(ConnectionString))
            {
                await connection.OpenAsync();
                using (var command = new SqliteCommand(GetProductPricesSql, connection))
                {
                    command.Parameters.AddWithValue("@product_id", args.ProductId);
                    using (var reader = await command.ExecuteReaderAsync())
                    {
                        var result = new List<GetProductPricesRow>();
                        while (await reader.ReadAsync())
                            result.Add(new GetProductPricesRow { ProductId = reader.GetInt32(0), UnitPrice = reader.GetDecimal(1) });
                        return result;
                    }
                }
            }
        }

        if (this.Transaction?.Connection == null || this.Transaction?.Connection.State != ConnectionState.Open)
            throw new InvalidOperationException("Transaction is provided, but its connection is null.");
        using (var command = this.Transaction.Connection.CreateCommand())
        {
            command.CommandText = GetProductPricesSql;
            command.Transaction = this.Transaction;
            command.Parameters.AddWithValue("@product_id", args.ProductId);
            using (var reader = await command.ExecuteReaderAsync())
            {
                var result = new List<GetProductPricesRow>();
                while (await reader.ReadAsync())
                    result.Add(new GetProductPricesRow { ProductId = reader.GetInt32(0), UnitPrice = reader.GetDecimal(1) });
                return result;
            }
        }
    }
}