#!/usr/bin/env bash

filename=$1

cat <<EOF > "$filename"
# auto-generated by $0 - do not edit
FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build-env

WORKDIR /app
COPY *.sln .

EOF

projects=$(dotnet sln list | grep csproj | awk -F'/' '{print $1}')
for project in $projects; do
    echo "COPY $project/*.csproj ./$project/" >> "$filename"
done
echo "" >> "$filename"
for project in $projects; do
    echo "COPY $project/ ./$project/" >> "$filename"
done
echo "" >> "$filename"
echo "RUN dotnet restore" >> "$filename"