// auto-generated by sqlc - do not edit
using Dapper;
using NpgsqlTypes;
using System.Data;
using System.Linq;
using System.Net;
using System.Net.NetworkInformation;
using System.Text.Json;

namespace NpgsqlDapperExampleGen;
public static class Utils
{
    public class JsonElementTypeHandler : SqlMapper.TypeHandler<JsonElement>
    {
        public override JsonElement Parse(object value)
        {
            if (value is string s)
                return JsonDocument.Parse(s).RootElement;
            if (value is null)
                return default;
            throw new DataException($"Cannot convert {value?.GetType()} to JsonElement");
        }

        public override void SetValue(IDbDataParameter parameter, JsonElement value)
        {
            parameter.Value = value.GetRawText();
        }
    }

    public static void ConfigureSqlMapper()
    {
        SqlMapper.AddTypeHandler(typeof(JsonElement), new JsonElementTypeHandler());
        RegisterNpgsqlTypeHandler<NpgsqlPoint>();
        RegisterNpgsqlTypeHandler<NpgsqlLine>();
        RegisterNpgsqlTypeHandler<NpgsqlLSeg>();
        RegisterNpgsqlTypeHandler<NpgsqlBox>();
        RegisterNpgsqlTypeHandler<NpgsqlPath>();
        RegisterNpgsqlTypeHandler<NpgsqlPolygon>();
        RegisterNpgsqlTypeHandler<NpgsqlCircle>();
        RegisterNpgsqlTypeHandler<NpgsqlCidr>();
        RegisterNpgsqlTypeHandler<IPAddress>();
        RegisterNpgsqlTypeHandler<PhysicalAddress>();
    }

    private class NpgsqlTypeHandler<T> : SqlMapper.TypeHandler<T> where T : notnull
    {
        public override T Parse(object value)
        {
            return (T)value;
        }

        public override void SetValue(IDbDataParameter parameter, T? value)
        {
            parameter.Value = value;
        }
    }

    private static void RegisterNpgsqlTypeHandler<T>()
        where T : notnull
    {
        SqlMapper.AddTypeHandler(typeof(T), new NpgsqlTypeHandler<T>());
    }
}